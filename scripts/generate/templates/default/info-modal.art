<template>
  <VbenModal
    v-model:open="modalState.isOpen"
    :loading="modalState.loading"
    :title="modalState.title"
    class="<{tableCamelName}>-info-modal"
    width="800px"
    @close="handleClose"
  >
    <div class="p-4">
      <a-descriptions :column="2" bordered>
<{each columns}><{if $value.isList == '1'}>
        <a-descriptions-item label="<{$value.columnComment}>">
<{if $value.javaType == 'Date'}>
          {{ info.<{$value.javaField}> ? dayjs(info.<{$value.javaField}>).format('YYYY-MM-DD HH:mm:ss') : '' }}
<{else if $value.dictType || ($value.ext?.options && $value.ext.options.length > 0)}>
          {{ get<{$value.javaField | capitalize}>Label(info.<{$value.javaField}>) }}
<{else if $value.htmlType == 'imageUpload'}>
          <a-image
            v-if="info.<{$value.javaField}>"
            :src="info.<{$value.javaField}>"
            :width="100"
            fallback="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMIAAADDCAYAAADQvc6UAAABRWlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGASSSwoyGFhYGDIzSspCnJ3UoiIjFJgf8LAwSDCIMogwMCcmFxc4BgQ4ANUwgCjUcG3awyMIPqyLsis7PPOq3QdDFcvjV3jOD1boQVTPQrgSkktTgbSf4A4LbmgqISBgTEFyFYuLykAsTuAbJEioKOA7DkgdjqEvQHEToKwj4DVhAQ5A9k3gGyB5IxEoBmML4BsnSQk8XQkNtReEOBxcfXxUQg1Mjc0dyHgXNJBSWpFCYh2zi+oLMpMzyhRcASGUqqCZ16yno6CkYGRAQMDKMwhqj/fAIcloxgHQqxAjIHBEugw5sUIsSQpBobtQPdLciLEVJYzMPBHMDBsayhILEqEO4DxG0txmrERhM29nYGBddr//5/DGRjYNRkY/l7////39v///y4Dmn+LgeHANwDrkl1AuO+pmgAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAwqADAAQAAAABAAAAwwAAAAD9b/HnAAAHlklEQVR4Ae3dP3Ik1RnG4W+FgYxN"
          />
          <span v-else>-</span>
<{else}>
          {{ info.<{$value.javaField}> || '-' }}
<{/if}>
        </a-descriptions-item>
<{/if}><{/each}>
      </a-descriptions>
    </div>
  </VbenModal>
</template>

<script lang="ts" setup>
import { reactive, ref } from 'vue';

import { VbenModal } from '@vben/common-ui';
import dayjs from 'dayjs';

import { <{tableCamelName}>Info } from '#/api/<{schemaGroupCode}>/<{tableCamelName}>';
<{if columns.some(col => col.dictType || (col.ext?.options && col.ext.options.length > 0))}>
import { getDictOptions } from '#/utils/dict';
import { DictEnum } from '@vben/constants';
<{/if}>

interface Props {
  id?: number | string;
}

defineOptions({ name: '<{className}>InfoModal' });

const props = withDefaults(defineProps<Props>(), {
  id: '',
});

const modalState = reactive({
  isOpen: false,
  loading: false,
  title: '<{functionName}>详情',
});

const info = ref<any>({});

<{each columns}><{if $value.dictType || ($value.ext?.options && $value.ext.options.length > 0)}>
/**
 * 获取<{$value.columnComment}>标签
 */
function get<{$value.javaField | capitalize}>Label(value: any) {
  const options = <{if $value.dictType}>getDictOptions(DictEnum.<{$value.dictType}>)<{else}>[<{each $value.ext.options}>
    { label: '<{$value.label}>', value: '<{$value.value}>' },<{/each}>]<{/if}>;
  const option = options.find(item => item.value === value);
  return option ? option.label : value;
}

<{/if}><{/each}>/**
 * 打开模态框
 */
async function openModal() {
  modalState.isOpen = true;

  if (props.id) {
    modalState.loading = true;
    try {
      const data = await <{tableCamelName}>Info(props.id);
      info.value = data;
    } catch (error) {
      console.error('获取数据失败:', error);
    } finally {
      modalState.loading = false;
    }
  }
}

/**
 * 关闭模态框
 */
function handleClose() {
  modalState.isOpen = false;
  info.value = {};
}

defineExpose({
  openModal,
});
</script>
